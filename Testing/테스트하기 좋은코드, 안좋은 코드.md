외부에 영향을 주거나(메일발송, 타사의 API사용, DB), 외부로 부터 영향을 받는 코드는 테스트가 어렵다.

반대로 말하면 위와 같은 경우가 아니라면 테스트하기 좋은 코드라는 뜻이다.

아래 글에 많은 영향을 받았다.
https://jwchung.github.io/testable-code

-------------------------------더 보기 -----------------------


테스트를 하기 어렵다는 것이 테스트가 불가능 하다는것은 아니다. 필자는 테스트코드없이 개발을 진행해왔는데 어떻게든 테스트는 진행해야 했기에 팀원 전체가 수동 테스트를 진행했다.

체크리스트 작성, 테스트 결과 확인 등 시간과 인력, 비용이 많이 들어갔다. 앞으로 설명하겠지만 테스트하기 어려운 코드에 대한 테스트도 확실히 필요하다. 다만 테스트하기 쉬운코드를 많이 작성 할 수 있도록 코드가 작성되어야 한다고 생각한다.


테스트 하기 어려운 코드

유형 1. 외부 세상에 영향을 받는 코드

아래 JS 코드를 참고해보자

```
function isMorning() {
    const now = new Date();
    if (now.getHours() < 12) return true;
    return false;
}

```
위 코드의 테스트 코드를 짠다고 생각해보자

```
describe('isMorning function 테스트', () => {
    it('오전에 실행하면 true!!', () => {
        expect(isMorning()).toBe(true)
    })
})
```

저 테스트는 언제 실행시키냐에 따라 테스트가 성공하거나 실패하게 될 것이다. (오전에 실행하면 True라니 말도 안되는 테스트를 작성할 수 밖에 없다.) 

위의 코드는 가장 간단하고 대표적인 예시이며 외부 세상에 영향을 받는 대표적인 경우는 다음과 같다.

- 함수 또는 메서드 내부에서 전역변수를 참조하는 경우
- 로컬 머신, 외부 저장소등에 존재하는 파일을 읽고 처리하는 경우
- 데이터 베이스의 레코드를 참조하는 코드
- 외부 API를 사용하는 경우


유형 2. 외부 세상에 영향을 주는 코드

필자는 서비스에서 SendBird 라는 채팅 SDK를 사용하고 있다.
아래와 같은 채팅메세지를 보내는 함수가 있다고 해보자

```
async function sendMessage(message, userId) {
    return await sendBirdSDK.send(message, userId)
}
```

코드는 단순하지만 테스트는 그렇지 않다. 이 함수를 테스트하기 위해서는 그래서 진짜 저 함수가 실행되면 SendBird에서 메세지를 보내주나? 이다.

위의 함수를 테스트 하는 방법은 수동 테스트가 가장 적절하다고 생각한다.

함수를 실행시키고, 특정유저의 메세지에서 내가 보낸 메세지를 찾아서 일치하는 지 확인하는 테스트 코드 작성(절대 하면 안되는 테스트 방법)이 안되는 이유는 대강 다음과 같이 설명할 수 있다.

- 테스트 코드 자체가 유형 1에 해당하게 작성될 수 밖에 없음.
- 센드버드 서버에 오류가 생기면 테스트가 실패하게됨(?) <= 테스트 코드로써의 가치가 없음
- 메세지를 받은 당사자가 메세지를 지워버려서 테스트가 실패 할 수 있다.

이 처럼 외부에 영향을 주는 코드의 테스트는 외부에 영향을 받는 형식으로 작성 될 수 밖에 없다.